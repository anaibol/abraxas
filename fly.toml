app = 'abraxas-5wboyw'
primary_region = 'gru'

[build]

[env]
# SQLite file on the persistent volume mounted at /data.
# Override with a fly secret (fly secrets set DATABASE_URL=...) to use Turso instead.
DATABASE_URL = "file:/data/prod.db"
# Serve the built client from the container path (keeps runtime consistent
# with the Docker image `ENV STATIC_DIR=/app/apps/client/dist`).
STATIC_DIR = "/app/apps/client/dist"

[http_service]
auto_start_machines = true
auto_stop_machines = false
force_https = true
internal_port = 8080
max_machines_running = 1
min_machines_running = 1

[[http_service.checks]]
grace_period = "30s"
interval = "15s"
method = "GET"
path = "/health"
timeout = "5s"

[[vm]]
cpu_kind = 'performance'
cpus = 1
memory = '2gb'

[deploy]
release_command = "sh -c 'cd apps/server && bunx prisma migrate deploy'"

[mounts]
destination = "/data"
source = "abraxas_data"
